<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Mapeando Mesas</title>
  <style>
    #mapa {
      position: relative;
      width: 950px;
      height: 550px;
      border: 1px solid #ccc;
      margin-bottom: 12px;
      background: url('https://i.imgur.com/CKLwEin.png') no-repeat center center;
      background-size: cover;
    }
    .mesa {
      position: absolute;
      width: 40px;
      height: 40px;
      background: #fff868;
      border: 2px solid #b38808;
      border-radius: 50%;
      color: #211f1a;
      font-weight: bold;
      text-align: center;
      line-height: 40px;
      cursor: pointer;
      box-shadow: 1px 2px 7px #0003;
      user-select: none;
      transition: box-shadow 0.2s;
    }
    .mesa.vendida {
      background: #c83434;
      color: #fff;
      border: 2px solid #ad2222;
    }
    .mesa:hover {
      box-shadow: 0 0 12px #222a;
    }
    .tooltip {
      position: absolute;
      padding: 2px 8px;
      background: #222e;
      color: #fff;
      border-radius: 6px;
      white-space: nowrap;
      z-index: 2;
      font-size: 12px;
      left: 45px;
      top: 0px;
      display: none;
      pointer-events: none;
    }
    #lista {
      max-height: 540px;
      overflow-y: auto;
      border: 1px solid #8884;
      background: #fff;
      padding: 10px;
      font-size: 15px;
      margin: 8px 0;
      width: 360px;
      display: inline-block;
      vertical-align: top;
      border-radius: 7px;
    }
    #painel-admin {
      margin: 16px 0;
    }
    #sair-admin {
      margin-left: 16px;
    }
    #admin-banner {
      color: #fff;
      background: #cb8a10;
      padding: 6px 18px;
      display: inline-block;
      margin: 10px 0;
      border-radius: 8px;
      letter-spacing: 2px;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 1px 1px 6px #0002;
    }
    body {
      font-family: Arial, sans-serif;
    }
    #painel-principal {
      display: flex;
      flex-direction: row;
      gap: 30px;
    }
  </style>
</head>
<body>
  <h2>Festa Junina - Venda das Mesas</h2>
  <div id="painel-admin">
    <button id="entrar-admin">Entrar Modo Admin</button>
    <button id="sair-admin" style="display:none;">Sair do Admin</button>
    <span id="admin-banner" style="display:none;">MODO ADMINISTRADOR</span>
  </div>
  <div id="painel-principal">
    <div id="mapa"></div>
    <div id="lista">
      <b>Mesas Vendidas</b>
      <ul id="compradores" style="padding-left: 18px"></ul>
    </div>
  </div>

  <script>
    // --------- SENHA ADMIN AQUI --------
    const ADMIN_SENHA = "festajununa2025";
    let modoAdmin = false;

    // --- Layout das mesas (só como exemplo; ajuste ao seu mapa se quiser) ---
    const mesas = [
      {n: 1, x: 68,  y:60},   {n: 2, x: 128, y:60},   {n: 3, x:188, y:60}, {n: 4, x:248, y:60},
      {n: 5, x:328, y:60},   {n: 6, x:388, y:60},   {n: 7, x:448, y:60}, {n:8, x:508, y:60},
      // ...adicione as mesas conforme seu layout!
      {n: 9, x: 630, y: 110}, {n: 10, x: 680, y: 160},
      {n: 11, x: 62,  y: 170}, {n: 12, x: 122, y: 170}, {n: 13, x:182, y:170}, // Etc!
      {n: 14, x:242, y:170}, {n:15, x:302, y:170}, {n:16, x:362, y:170},
      {n:17, x:422, y:170}, {n:18, x:482, y:170}, {n:19, x:542, y:170},
      {n:20, x:602, y:170}
    ];

    let dadosMesas = {}; // {numero: {vendida, comprador}}

    // SLUG mesa (por ex: 13 fica "mesa13") para usar como id no DOM
    function slugMesa(n) { return "mesa" + n; }

    function salva(mesan, obj) {
      dadosMesas[mesan] = obj;
      // No original só fica em ram. (Se tiver firebase, salve aqui!)
    }

    function carrega(mesan) {
      return dadosMesas[mesan] || {vendida: false, comprador: ""};
    }

    function salvarEmLocalStorage() {
      localStorage.setItem('dadosMesasJunina2025', JSON.stringify(dadosMesas));
    }

    function carregarDoLocalStorage() {
      const d = localStorage.getItem('dadosMesasJunina2025');
      if (d) dadosMesas = JSON.parse(d);
    }

    function desenhaMapa() {
      const mapa = document.getElementById('mapa');
      mapa.innerHTML = '';
      mesas.forEach(m => {
        const div = document.createElement('div');
        div.className = 'mesa';
        div.style.left = m.x+'px';
        div.style.top = m.y+'px';
        div.innerText = m.n;
        div.id = slugMesa(m.n);
        let dado = carrega(m.n);
        if (dado.vendida) div.classList.add('vendida');
        // Tooltip
        let tt = document.createElement('div');
        tt.className = "tooltip";
        tt.id = "tt_"+slugMesa(m.n);
        if(dado.vendida) tt.innerText = "Vendida para: " + dado.comprador;
        else tt.innerText = "Disponível";
        div.appendChild(tt);

        // Interação
        div.onmouseenter = () => { tt.style.display = "inline-block"; }
        div.onmouseleave = () => { tt.style.display = "none"; }

        div.onclick = () => {
          if(!modoAdmin) return;
          if(dado.vendida) {
            // Desvender...
            if(confirm(`Desmarcar mesa ${m.n} como vendida?`)) {
              salva(m.n, {vendida: false, comprador: ""});
              salvarEmLocalStorage();
              desenhaMapa();
              updateList();
            }
          } else {
            let comprador = prompt(`Nome do comprador da mesa ${m.n}?`);
            if(comprador && comprador.trim().length > 0) {
              salva(m.n, {vendida: true, comprador: comprador.trim()});
              salvarEmLocalStorage();
              desenhaMapa();
              updateList();
            }
          }
        };
        mapa.appendChild(div);
      });
    }
    // ---- Listagem lateral
    function updateList() {
      let compradores = [];
      mesas.forEach(m => {
        let d = carrega(m.n);
        if (d.vendida && d.comprador)
          compradores.push({n: m.n, nome: d.comprador});
      });
      compradores.sort((a,b) => a.n - b.n);
      let ul = document.getElementById('compradores');
      ul.innerHTML = '';
      compradores.forEach(obj => {
        let li = document.createElement('li');
        li.innerText = `Mesa ${obj.n}: ${obj.nome}`;
        ul.appendChild(li);
      });
    }
    // ------------ Admin
    function setAdmin(valor) {
      modoAdmin = valor;
      document.getElementById('admin-banner').style.display = valor ? "inline-block" : "none";
      document.getElementById('sair-admin').style.display = valor ? "inline-block" : "none";
      document.getElementById('entrar-admin').style.display = valor ? "none" : "inline-block";
    }
    document.getElementById('entrar-admin').onclick = function() {
      let senha = prompt("Senha do administrador:");
      if(senha === ADMIN_SENHA) {
        setAdmin(true);
        alert("Bem-vindo, admin!");
      } else {
        alert("Senha incorreta.");
      }
    }
    document.getElementById('sair-admin').onclick = function() {
      setAdmin(false);
    }

    // Carrega do localStorage antes de desenhar
    carregarDoLocalStorage();
    // No início, só visitantes podem ver o mapa
    setAdmin(false);
    desenhaMapa();
    updateList();
  </script>
</body>
</html>
